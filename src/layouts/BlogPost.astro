---
import type { CollectionEntry } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';
import { siteConfig } from '../data/siteConfig';

type Props = CollectionEntry<'blog'>['data'] & { slug: string; readingTime?: number };

const { title, description, pubDate, updatedDate, heroImage, tags = [], canonicalUrl, slug, readingTime } = Astro.props;

const canonical = canonicalUrl ?? `${siteConfig.siteUrl}/blog/${slug}`;
const formattedDate = pubDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
---

<html lang="en" class="scroll-smooth">
	<head>
		<BaseHead
			title={title}
			description={description}
			image={heroImage ? undefined : siteConfig.ogImage}
			canonicalUrl={canonical}
			type="article"
			pubDate={pubDate}
			updatedDate={updatedDate}
		/>
	</head>

	<body style="background-color:var(--bg-base);color:var(--text-primary);" class="antialiased">
		<Header />
		<main class="max-w-3xl mx-auto px-4 sm:px-6 py-12">
			<article>
				<header class="mb-10">
					<div class="flex flex-wrap items-center gap-3 text-sm mb-4 font-mono" style="color:var(--text-tertiary);">
						<time datetime={pubDate.toISOString()}>{formattedDate}</time>
						{readingTime && <span>&middot; {readingTime} min read</span>}
						{updatedDate && (
							<span class="italic">&middot; Updated {updatedDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}</span>
						)}
					</div>
					<h1 class="text-3xl sm:text-4xl font-bold leading-tight mb-4" style="color:var(--text-primary);letter-spacing:-0.03em;">{title}</h1>
					<p class="text-lg leading-relaxed" style="color:var(--text-secondary);">{description}</p>
					{tags.length > 0 && (
						<div class="flex flex-wrap gap-2 mt-4">
							{tags.map((tag) => (
								<span class="text-xs px-2 py-0.5 rounded font-mono"
									style="background:var(--bg-muted);border:1px solid var(--border-muted);color:var(--text-tertiary);">
									{tag}
								</span>
							))}
						</div>
					)}
				</header>

				<!-- Divider before prose -->
				<div style="border-top:1px solid var(--border-muted);margin-bottom:2.5rem;"></div>

				<div class="prose max-w-none"
					style="--tw-prose-body:var(--text-secondary);--tw-prose-headings:var(--text-primary);--tw-prose-links:var(--link);--tw-prose-bold:var(--text-primary);--tw-prose-code:var(--link-hover);--tw-prose-pre-bg:var(--bg-surface);">
					<slot />
				</div>

				<footer class="mt-12 pt-8" style="border-top:1px solid var(--border);">
					<div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
						<div>
							<p class="font-semibold mb-0" style="color:var(--text-primary);">{siteConfig.author}</p>
							<p class="text-sm mb-0" style="color:var(--text-tertiary);">{siteConfig.authorTitle}</p>
						</div>
						<div class="flex gap-4">
							<a href={siteConfig.social.linkedin} target="_blank" rel="noopener noreferrer"
								class="text-sm no-underline transition-colors" style="color:var(--link);"
								onmouseover="this.style.color='var(--link-hover)'" onmouseout="this.style.color='var(--link)'">
								LinkedIn
							</a>
							<a href={siteConfig.social.github} target="_blank" rel="noopener noreferrer"
								class="text-sm no-underline transition-colors" style="color:var(--link);"
								onmouseover="this.style.color='var(--link-hover)'" onmouseout="this.style.color='var(--link)'">
								GitHub
							</a>
						</div>
					</div>
				</footer>
			</article>
		</main>
		<Footer />
	</body>
</html>
