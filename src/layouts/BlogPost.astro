---
import type { CollectionEntry } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';
import { siteConfig } from '../data/siteConfig';

type Props = CollectionEntry<'blog'>['data'] & { slug: string; readingTime?: number };

const { title, description, pubDate, updatedDate, heroImage, tags = [], canonicalUrl, slug, readingTime } = Astro.props;

const canonical = canonicalUrl ?? `${siteConfig.siteUrl}/blog/${slug}`;
const formattedDate = pubDate.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
---

<html lang="en" class="scroll-smooth">
	<head>
		<BaseHead
			title={title}
			description={description}
			image={heroImage ? undefined : siteConfig.ogImage}
			canonicalUrl={canonical}
			type="article"
			pubDate={pubDate}
			updatedDate={updatedDate}
		/>
	</head>

	<body style="background-color:var(--bg-base);color:var(--text-primary);" class="antialiased">
		<Header />
		<main class="max-w-3xl mx-auto px-4 sm:px-6 py-12">
			<article>
				<header class="mb-10">
					<div class="flex flex-wrap items-center gap-3 mb-5">
						<span class="font-mono" style="font-size:0.7rem;letter-spacing:0.06em;text-transform:uppercase;color:var(--text-tertiary);">
							<time datetime={pubDate.toISOString()}>{formattedDate}</time>
						</span>
						{readingTime && (
							<span class="font-mono" style="font-size:0.7rem;letter-spacing:0.06em;text-transform:uppercase;color:var(--text-tertiary);">
								· {readingTime} min read
							</span>
						)}
						{updatedDate && (
							<span class="font-mono" style="font-size:0.7rem;letter-spacing:0.06em;text-transform:uppercase;color:var(--text-tertiary);">
								· updated {updatedDate.toLocaleDateString('en-US', { month: 'short', year: 'numeric' })}
							</span>
						)}
					</div>
					<h1 class="font-bold leading-tight mb-4" style="font-size:clamp(1.75rem,4vw,2.5rem);color:var(--text-primary);letter-spacing:-0.03em;">{title}</h1>
					<p class="text-lg leading-relaxed mb-0" style="color:var(--text-secondary);">{description}</p>
					{tags.length > 0 && (
						<div class="flex flex-wrap gap-3 mt-4">
							{tags.map((tag) => (
								<span class="font-mono" style="font-size:0.7rem;letter-spacing:0.04em;text-transform:uppercase;color:var(--text-tertiary);">
									{tag}
								</span>
							))}
						</div>
					)}
				</header>

				<div style="border-top:1px solid var(--border);margin-bottom:2.5rem;"></div>

				<div class="prose max-w-none">
					<slot />
				</div>

				<footer class="mt-12 pt-8" style="border-top:1px solid var(--border);">
					<div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
						<div>
							<p class="font-semibold text-sm mb-0" style="color:var(--text-primary);">{siteConfig.author}</p>
							<p class="font-mono mb-0" style="font-size:0.7rem;letter-spacing:0.04em;text-transform:uppercase;color:var(--text-tertiary);">{siteConfig.authorTitle}</p>
						</div>
						<div class="flex gap-4">
							<a href={siteConfig.social.linkedin} target="_blank" rel="noopener noreferrer"
								class="text-xs font-mono no-underline transition-colors" style="color:var(--text-tertiary);"
								onmouseover="this.style.color='var(--text-primary)'" onmouseout="this.style.color='var(--text-tertiary)'">
								linkedin ↗
							</a>
							<a href={siteConfig.social.github} target="_blank" rel="noopener noreferrer"
								class="text-xs font-mono no-underline transition-colors" style="color:var(--text-tertiary);"
								onmouseover="this.style.color='var(--text-primary)'" onmouseout="this.style.color='var(--text-tertiary)'">
								github ↗
							</a>
						</div>
					</div>
				</footer>
			</article>
		</main>
		<Footer />
	</body>
</html>
